app-id: com.moderndaypost.modern-day-post-app
runtime: org.freedesktop.Platform
runtime-version: '1.6'
branch: stable
sdk: org.freedesktop.Sdk
base: io.atom.electron.BaseApp
base-version: stable
command: run.sh
separate-locales: false
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
  - --share=network
build-options:
  cflags: -O2 -g
  cxxflags: -O2 -g
  env:
    NPM_CONFIG_LOGLEVEL: info
modules:
  - name: nodejs
    cleanup:
      - /include
      - /share
      - /app/lib/node_modules/npm/changelogs
      - /app/lib/node_modules/npm/doc
      - /app/lib/node_modules/npm/html
      - /app/lib/node_modules/npm/man
      - /app/lib/node_modules/npm/scripts
    sources:
      - type: archive
        url: https://nodejs.org/dist/v8.11.2/node-v8.11.2.tar.xz
        sha256: 539946c0381809576bed07424a35fc1740d52f4bd56305d6278d9e76c88f4979
  - name: modern-day-post-app
    build-options:
      env:
        # Need this for electron-download to find the cached electron binary
        electron_config_cache: /run/build/modern-day-post-app/npm-cache
    buildsystem: simple
    sources:
      - type: archive
        url: https://github.com/yanike/moderndaypost-app/releases/download/MDP-R/modern-day-post-app-1.0.0.tar.xz
        sha256: 12aeeb12f27b72ec7df879446826888f5211f032d83be52aa282be1a125dea48
        dest: main
      - generated-sources.json
      # Wrapper to launch the app
      - type: script
        dest-filename: run.sh
        commands:
          - npm start --prefix=/app/main
    build-commands:
      # Install npm dependencies
      - npm install --prefix=main --offline --cache=/run/build/modern-day-post-app/npm-cache/
      # Bundle app and dependencies
      - mkdir -p /app/main /app/bin
      - cp -ra main/* /app/main/
      # Install app wrapper
      - install run.sh /app/bin/
